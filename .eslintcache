[{"/mnt/c/Users/eleet/projects/misc/tidings/src/containers/CardCreationContainer.js":"1","/mnt/c/Users/eleet/projects/misc/tidings/src/App.js":"2","/mnt/c/Users/eleet/projects/misc/tidings/src/index.js":"3","/mnt/c/Users/eleet/projects/misc/tidings/src/components/CardDestinationForm.js":"4","/mnt/c/Users/eleet/projects/misc/tidings/src/components/SearchInput.js":"5","/mnt/c/Users/eleet/projects/misc/tidings/src/components/ImageUploadForm.js":"6","/mnt/c/Users/eleet/projects/misc/tidings/src/components/CheckoutCard.js":"7","/mnt/c/Users/eleet/projects/misc/tidings/src/components/Success.js":"8","/mnt/c/Users/eleet/projects/misc/tidings/src/components/Error.js":"9","/mnt/c/Users/eleet/projects/misc/tidings/src/visuals/Lottie.js":"10","/mnt/c/Users/eleet/projects/misc/tidings/src/containers/AboutContainer.js":"11"},{"size":7537,"mtime":1609004217348,"results":"12","hashOfConfig":"13"},{"size":1223,"mtime":1609018927325,"results":"14","hashOfConfig":"13"},{"size":148,"mtime":1608304738902,"results":"15","hashOfConfig":"13"},{"size":1385,"mtime":1609003379025,"results":"16","hashOfConfig":"13"},{"size":2123,"mtime":1608936173024,"results":"17","hashOfConfig":"13"},{"size":551,"mtime":1609003375329,"results":"18","hashOfConfig":"13"},{"size":561,"mtime":1609003371027,"results":"19","hashOfConfig":"13"},{"size":2357,"mtime":1608998025862,"results":"20","hashOfConfig":"13"},{"size":1011,"mtime":1608998040329,"results":"21","hashOfConfig":"13"},{"size":405,"mtime":1608909413530,"results":"22","hashOfConfig":"13"},{"size":1891,"mtime":1609022583354,"results":"23","hashOfConfig":"13"},{"filePath":"24","messages":"25","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"26"},"qdf74k",{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"29"},{"filePath":"30","messages":"31","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"32"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"37","messages":"38","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"39","messages":"40","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"41","messages":"42","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"43","messages":"44","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"32"},{"filePath":"45","messages":"46","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"47"},{"filePath":"48","messages":"49","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/mnt/c/Users/eleet/projects/misc/tidings/src/containers/CardCreationContainer.js",["50","51"],"// main page for postcard image upload, destination setting, and checkout page redirect\r\nimport React, { useState, useEffect } from 'react'\r\nimport { geocodeByAddress } from 'react-places-autocomplete'\r\nimport { loadStripe } from '@stripe/stripe-js'\r\nimport ImageUploadForm from '../components/ImageUploadForm'\r\nimport CardDestinationForm from '../components/CardDestinationForm'\r\nimport CheckoutCard from '../components/CheckoutCard'\r\n\r\nconst Lob = require('lob')(process.env.REACT_APP_LOB_TEST_SECRET_KEY) // Lob object\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_LIVE_KEY) // Stripe object\r\n\r\nexport default function CardCreationContainer() {\r\n\r\n  // declaring state variables for card destination details\r\n  const initialValues = { senderName: '', recipientName: '', address1: '', address2: '', zip: '' }\r\n  const [values, setValues] = useState(initialValues)\r\n  const [remoteAddress, setRemoteAddress] = useState(null) // state variable for Lob-created address\r\n  const [picture, setPicture] = useState(null) // state variable for user-uploaded image in browser\r\n  const [remotePicture, setRemotePicture] = useState(null) // state variable for Cloudinary-hosted image location\r\n  const [checkoutDisabled, setCheckoutDisabled] = useState(null) // state variable for whether to disabled checkout button\r\n\r\n  // clearing out user's local storage on initial page load\r\n  useEffect(() => {\r\n    localStorage.clear()\r\n  }, [])\r\n\r\n  // add address to Lob address book once destination form fields are filled\r\n  useEffect(() => {\r\n    if ( !!values.senderName & !!values.recipientName && !!values.address1 && !!values.zip ) {\r\n      addAddressToLob()\r\n    } else {\r\n      setRemoteAddress(null)\r\n    }\r\n  }, [values])\r\n\r\n  // toggle checkout button access once stored image and address are both present\r\n  useEffect(() => {\r\n    if ( !!remotePicture && remoteAddress !== null ) {\r\n      setCheckoutDisabled(false)\r\n    } else {\r\n      setCheckoutDisabled(true)\r\n    }\r\n  }, [remoteAddress, remotePicture])\r\n\r\n  // callback function to update state variable holding user image\r\n  // only need to store image on user image upload, not removal\r\n  const handleUpload = event => {\r\n    setPicture(event)\r\n    event.length !== 0 ? addImgToCloud() : setRemotePicture(null)\r\n  }\r\n\r\n  // storing user's uploaded image using Cloudinary and updating state with its new URL\r\n  const addImgToCloud = () => {\r\n    const imgLocation = findImgLocation()\r\n\r\n    if (imgLocation) {\r\n      const payload = {\r\n        // formatting data URL properly before making request\r\n        file: `${imgLocation.split(';').filter(str => !str.includes(\"name=\") ).join(';')}`,\r\n        upload_preset: 'tidings'\r\n      }\r\n\r\n      const configObj = {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify(payload)\r\n      }\r\n\r\n      fetch('https://cors-anywhere.herokuapp.com/https://api.Cloudinary.com/v1_1/df7waillu/image/upload', configObj)\r\n        .then(res => res.json())\r\n        .then(res => {\r\n            // updating state for image location in cloud storage with URL string from response\r\n            setRemotePicture(res.secure_url)\r\n          })\r\n        .catch(err => console.log(err))\r\n    } else {\r\n      console.log(\"can't find any user-uploaded image\")\r\n    }\r\n\r\n  } // end addImgToCloud()\r\n\r\n  // if available, grabbing the data URI for user's uploaded image file\r\n  const findImgLocation = () => {\r\n    if (document.querySelector(\".uploadPicture\")) {\r\n      return document.querySelector(\".uploadPicture\").getAttribute(\"src\")\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n\r\n  // state hook for updating user's destination form inputs\r\n  const handleChange = event => {\r\n    setValues({\r\n      ...values,\r\n      [event.target.name]: event.target.value\r\n    })\r\n  }\r\n\r\n  // callback updating address field and state variable\r\n  const handleAddressInputChange = addressStr => {\r\n    setValues({ ...values, address1: addressStr, zip: '' })\r\n  }\r\n\r\n  // callback updating address field and zip code state variable\r\n  const handleAddressInputSelect = addressStr => {\r\n    setValues({ ...values, address1: addressStr })\r\n    findZip(addressStr)\r\n  }\r\n\r\n  // state hook updating zip code\r\n  const findZip = addressStr => {\r\n    geocodeByAddress(addressStr)\r\n      .then(results => (results[0]))\r\n      .then(result => {\r\n        let zipCode = result.formatted_address.split(',').slice(-2, -1)[0].split(\" \").pop()\r\n        setValues({ ...values, zip: zipCode })\r\n      })\r\n      .catch(error => console.error('Error', error))\r\n  }\r\n\r\n  // adding an address to Lob address book with user inputted information\r\n  const addAddressToLob = () => {\r\n    let addressArr = values.address1.split(',').map(a => a.trim())\r\n\r\n    let addressee = {\r\n      name: values.recipientName,\r\n      address_line1: addressArr[0],\r\n      address_line2: values.address2,\r\n      address_city: addressArr[1],\r\n      address_state: addressArr[2],\r\n      address_zip: values.zip\r\n    }\r\n\r\n    // ensure user has selected a specific address, not just a town or city\r\n    // if so, add address to Lob address book and use response to set remoteAddress state variable\r\n    if ( !Number.isInteger(parseFloat(addressee.address_line1)) ) {\r\n      alert(\"You've entered an invalid destination address. Please try again.\")\r\n    } else {\r\n      Lob.addresses.create(addressee, (err, address) => {\r\n        if (err) {\r\n          alert(err)\r\n          setRemoteAddress(null)\r\n        } else {\r\n          setRemoteAddress(address.id)\r\n        }\r\n      })\r\n    }\r\n\r\n  } // end addAddressToLob()\r\n\r\n  // handling redirect to Stripe-hosted checkout page\r\n  const handleCheckout = async (event) => {\r\n    event.preventDefault()\r\n\r\n    // set local storage with info for sending postcard upon successful payment\r\n    localStorage.setItem('senderName', values.senderName )\r\n    localStorage.setItem('remotePicture', remotePicture )\r\n    localStorage.setItem('remoteAddress', remoteAddress )\r\n\r\n    const stripe = await stripePromise\r\n\r\n    // redirect to success page upon successful payment, error page otherwise\r\n    const { error } = await stripe.redirectToCheckout({\r\n      lineItems: [{\r\n        price: 'price_1I0cm0BrGXf3SoO6zIFh9jvE',\r\n        quantity: 1,\r\n      }],\r\n      mode: 'payment',\r\n      successUrl: 'https://tidings-app.netlify.app/success',\r\n      cancelUrl: 'https://tidings-app.netlify.app/error',\r\n    })\r\n\r\n    if (error) {\r\n      alert(error.message)\r\n    }\r\n\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"container  d-flex flex-column justify-content-center align-items-center  col-8 offset-2\">\r\n        <ImageUploadForm\r\n          handleUpload={handleUpload}\r\n        />\r\n        <br></br>\r\n\r\n        <CardDestinationForm\r\n          senderName={values.senderName}\r\n          recipientName={values.recipientName}\r\n          address1={values.address1}\r\n          address2={values.address2}\r\n          handleChange={handleChange}\r\n          handleAddressInputChange={handleAddressInputChange}\r\n          handleAddressInputSelect={handleAddressInputSelect}\r\n        />\r\n        <br></br>\r\n\r\n        <CheckoutCard\r\n          handleCheckout={handleCheckout}\r\n          checkoutDisabled={checkoutDisabled}\r\n        />\r\n        <br></br>\r\n      </div>\r\n\r\n      <footer className=\"container\">\r\n        <hr className=\"featurette-divider\" />\r\n        <p className=\"float-right pb-1\"><a href=\"/about\">About</a></p>\r\n      </footer>\r\n    </>\r\n  )\r\n\r\n}\r\n","/mnt/c/Users/eleet/projects/misc/tidings/src/App.js",[],["52","53"],"/mnt/c/Users/eleet/projects/misc/tidings/src/index.js",[],["54","55"],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/CardDestinationForm.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/SearchInput.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/ImageUploadForm.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/CheckoutCard.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/Success.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/components/Error.js",[],"/mnt/c/Users/eleet/projects/misc/tidings/src/visuals/Lottie.js",[],["56","57"],"/mnt/c/Users/eleet/projects/misc/tidings/src/containers/AboutContainer.js",[],{"ruleId":"58","severity":1,"message":"59","line":18,"column":10,"nodeType":"60","messageId":"61","endLine":18,"endColumn":17},{"ruleId":"62","severity":1,"message":"63","line":34,"column":6,"nodeType":"64","endLine":34,"endColumn":14,"suggestions":"65"},{"ruleId":"66","replacedBy":"67"},{"ruleId":"68","replacedBy":"69"},{"ruleId":"66","replacedBy":"70"},{"ruleId":"68","replacedBy":"71"},{"ruleId":"66","replacedBy":"72"},{"ruleId":"68","replacedBy":"73"},"no-unused-vars","'picture' is assigned a value but never used.","Identifier","unusedVar","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'addAddressToLob'. Either include it or remove the dependency array.","ArrayExpression",["74"],"no-native-reassign",["75"],"no-negated-in-lhs",["76"],["75"],["76"],["75"],["76"],{"desc":"77","fix":"78"},"no-global-assign","no-unsafe-negation","Update the dependencies array to be: [addAddressToLob, values]",{"range":"79","text":"80"},[1724,1732],"[addAddressToLob, values]"]